---
layout: post
title: "영변(영웅 변신) 획득은 플레이 변화에 영향을 미칠까?"
date: 2021-05-11 13:23:00
categories: Works
author : DANBI
cover: "/assets/l2m_cover.jpg"
---



# **들어가며**

 현실 경제에서 우리는 "어떤 큰 행운이 발생하였을 때, 그 이후 사람들은 더 열심히 생활하게 되는가?"라는 궁금증을 한번쯤은 가져보았을 것입니다. 로또에서 높은 금액에 당첨된 사람은 그 이후 더 열심히 사는가? 라는 주제가 적절한 예시인 것 같습니다. 다소 예전에 발간되었지만 "비근로로 얻은 소득(로또 당첨)이 이후 근로로 얻은 소득, 저축, 지출에 영향을 미치는가?"에 대한 주제를 다루는 논문이 있습니다. 해당 논문에서는 1980년대 중반에 매사추세츠에서 로또를 한 사람들을 대상으로 설문 조사를 실시한 결과, 당첨자들은 평균적으로 돈을 받은 이후 10년 안에 수령금의 84%를 다 쓴다는 결과가 나왔습니다. 

 이러한 사례가 게임에서는 어떻게 나타날까라는 궁금증으로 주제를 찾아보던 중 NC SOFT의 게임 중 유사한 경우가 있어 분석을 진행하게 되었습니다. 

 분석 내용에 앞서 배경 설명을 간략히 드리면, 게임 내에서 모든 캐릭터들은 직업을 갖습니다. 각 직업마다 등급(일반, 고급, 희귀, 영웅, 전설, 신화)이 있고 특정 등급으로 전직하기 위해서는 특별한 아이템이 필요합니다. 해당 아이템을 사용하여 높은 등급으로 전직하면 전반적인 캐릭터의 능력치가 향상되며 특히 영웅 등급부터 대폭 향상됩니다. 하지만, 영웅 전직을 위한 아이템을 얻기 매우 어렵기 때문에 영웅 전직(주로 "영변"이라 부릅니다)을 얻는 것이 대부분 유저의 게임 내 첫 목표입니다. 

<p align="center"><img src = "/assets/works/class_get_causal_analysis/image0.png" width="40%" /><br>
    [그림1] 첫 영변을 얻었을 때의 기분이란!</p>
 우연한 획득에 따른 매우 큰 이점이 존재한다는 점 때문에, 게임 내 "영변"을 획득하는 것은 현실 세계의 로또 복권 당첨과 유사한 면이 있다고 생각하였습니다. 그래서 "유저가 최초로 영웅/전설 등급 전직을 획득하면 그 이후 플레이를 더 열심히 할까?" 라는 궁금증이 생겼고 분석할 가치가 있다고 판단하여 분석을 진행하게 되었습니다. 

*(이하 문장의 간결성을 위해 "최초로 영웅/전설 등급 전직 획득"을 "영웅/전설 획득" 이라고 칭하겠습니다)*

# **분석 방식**

  분석 방법은 다음과 같습니다. 기존에 영웅/전설 획득을 한 적이 없는 유저들을 일주일간 관측하여 그 기간 동안 최초로 획득한 집단 (실험군) 과 그렇지 못한 집단 (대조군) 을 분류합니다. 이 후 두 집단의 플레이 시간 및 결제 금액 등의 게임 활동량과 관련된 값들이 이전에 비해 얼마나 달라졌는지 그 변화값을 측정한 후 두 집단의 차이가 통계적으로 유의한지 확인합니다. 이렇게 하면 영웅/전설 획득을 하지 않았을 때 대비 획득하였을 때의 플레이 변화를 볼 수 있기 때문에 영웅/전설 획득이 플레이 변화에 미치는 인과 효과를 확인할 수 있을 것입니다.

##### Q : 이게 끝인가요? A : 아니요, 생각보다 고려할게 많습니다...

위에서 설명드린 것만 보면 되게 단순합니다. <u>하지만, 이 방식으로 분석한 결과를 인과 효과라고 보장하기 위해서는 중요한 조건이 갖춰진 상태여야 합니다. 두 그룹(실험군, 대조군) 사이에 "영웅/전설 획득"을 제외하고 다른 성질이 동일해야한다는 조건입니다.</u> A가 B의 원인이다 라는 것을 확인하기 위해서는 B의 원인이 되는 다른 모든 것들을 동일하게 유지하고 A만 바꿔가며 B의 변화를 측정해야하기 때문입니다. (여기서는 A가 영웅/전설 획득, B가 플레이 변화를 의미하죠)

본 분석에서도 "플레이 변화"는 여러 요소에 영향을 받기 때문에 "영웅/전설 획득 때문에 플레이 변화가 일어 났다"라는 인과 효과를 확인하기 위해서는 다른 요소가 미치는 영향을 모두 동일하게 맞춰야 합니다. 

* 예를 들어, 00가 플레이 변화에 매우 중요한 원인 중 하나인데 실험군과 대조군에서 00가 매우 다르다면 어떻게 될까요?
* 또다른 예로, 00가 영웅/전설 획득과 플레이 변화에 대해 중요한 원인 중 하나라면요?

이런 경우에서 위의 방법대로 단순히 그룹 간 플레이 변화만 비교한다면 영웅/전설 획득이 플레이 변화에 원인이 아니었음에도 우리는 원인이다라고 잘못된 인과 효과를 주장할 수도 있습니다. 실제로는 00가 원인이었는데도 말이죠.

때문에 실험군, 대조군 간에 성질을 동일하게 맞춰주는 "인과 추론"이라는 절차가 본 분석에서 매우 중요하였고 그 과정을 먼저 소개드리려 합니다.



## 인과 추론이 뭐에요?

인과 추론은 우리가 확인하기 원하는 인과 효과를 추론하는 방법을 말합니다. 확인하려는 인과 효과를 제외한 다른 영향을 동일하게 맞춰주기 위해 어떤 요인을 건드려야 하는지(통제) 찾아가는 과정으로 이해하시면 좋을 것 같습니다. 그렇다면 외부 영향에는 어떤 것이 존재할까요?

### confounder(교란 변수)

<p align="center"><img src = "/assets/works/class_get_causal_analysis/image1.png" width="50%" /><br>[그림2] 원인 변수와 결과 변수에 동시에 영향을 주는 교란 변수</p>



* 애초에 게임에 애착이 많은 유저는 영웅/전설 획득 가능성이 높을 수 있으며, 플레이 변화가 증가할 가능성(게임을 열심히 함)도 높을 수 있습니다.
* 게임에 대한 애착도가 영웅/전설 획득과 플레이 변화에 동시에 영향을 주기 때문에, 실제로 영웅/전설 획득과 플레이 변화 간에 인과 관계가 없더라도 "상관성"이 생길 수 있습니다.("인과 관계"가 아니라 교란 변수에 의한 "상관성"일 가능성이 높습니다)
* 즉, 실제로 영웅/전설 획득으로 인해 플레이 변화가 발생한 것이 아님에도 불구하고, 영웅/전설 획득이 플레이 변화를 야기하는 윈인이다라는 잘못된 판단을 하게 될 수 있습니다.

 이처럼 교란 변수는 인과 관계 추정에 혼란을 야기하는 요소입니다. 교란 변수의 영향을 제거하지 못한 채 단순히 실험군, 대조군의 "플레이 변화"의 차이를 비교하여 인과 효과를 추정하려 한다면 잘못된 결과를 얻을 수 있습니다. 

그렇다면 교란 변수에 의한 "상관성"을 제거하고 우리가 원하는 인과 효과를 추정하려면 어떻게 해야할까요? 바로 교란 변수를 통제한 후 실험군, 대조군 간 "플레이 변화"를 비교하면 됩니다. 교란 변수를 통제한다는 것은 교란 변수의 값이 같은 샘플끼리 묶어서 비교한다는 의미이고, 실제 분석 시에는 추정 모델에 교란 변수를 통제 변수로 추가하여 적용할 수 있습니다. 

*교란 변수는 통제를 해야하는 이유에 대해서는 Appendix에 수식으로 설명되어 있으니 참고하시면 좋을 것 같습니다.* 

### collider

 그렇다면 교란 변수로 판단되는 가능한 많은 변수를 통제하여 인과 관계를 추정하면 될까요? 여기서 조심해야할 것이 있습니다. 원인 변수와 결과 변수의 영향을 동시에 받는 변수는 통제 대상에서 제외하여야 합니다.(이런 변수를 collider라고 부릅니다) 그 이유는 collider를 통제하면 이를 만족하는 원인 변수 값, 결과 변수 값을 가진 샘플들만 남게 되기 때문입니다. 이는 원인 변수, 결과 변수 간에 특정 종속 관계를 형성하고 최종적으로 분석 결과에 편향을 유발합니다. 이를 collider bias라고 부릅니다. 

<p align="center"><img src = "/assets/works/class_get_causal_analysis/image2_1.png" width="50%" /><br>[그림3-1] 원인 변수와 결과 변수에 동시에 영향을 받는 collider</p>



즉, 실제로 원인 변수와 결과 변수 간 인과 관계가 없더라도 collider를 통제하여 추정하면 원인 변수와 결과 변수 간에 종속관계가 있는 샘플만으로 영향을 추정하는 것이므로 상관성이 생기게 됩니다. 그리고 우리는 그 상관성을 인과 관계로 오해할 수 있기 때문에 collider는 통제하지 말아야 합니다.

<p align="center"><img src = "/assets/works/class_get_causal_analysis/image2_2.png" width="65%" /><br>[그림3-2] collider bias에 대한 예시</p>



**정리하면, 우리가 보고자 하는 원인 변수(영웅/전설 획득)가 결과 변수(플레이 변화)에 미치는 인과 효과를 추정하기 위해서는 다양한 외부 변수와의 관계를 고려한 후 실제로 통제가 필요한 변수만을 선별하는 과정이 필요합니다.**

* **통제 변수가 될 수 있는 변수 후보를 정리해봅니다.**
* **원인 변수, 결과 변수, 통제 변수 간 인과 관계를 인과 다이어그램으로 표시합니다.**
* **인과 다이어그램을 바탕으로 우리가 추정하고자 하는 인과 효과 제외한 외부 영향을 제거할 수 있는 통제 변수 집합을 선정합니다**
* **선정한 통제 변수들을 통제하여 인과 효과를 추정합니다.(본 분석에서는 회귀식에 독립 변수로 추가하여 통제하였습니다)** 

# **분석 설계**

위에서 정리한 내용을 바탕으로 다음과 같이 인과 분석을 설계하였습니다. 

1. 변수 정의
2. 분석 기간 선정
3. 대상 선정
4. 비교 그룹
5. 인과 다이어그램을 통한 통제 변수 구성

## 1. 변수 정의

#### 1-1. 원인 변수 및 결과 변수

 원인 변수는 위에서 설명드린 것과 같이 "최초 영웅/전설 획득 여부"로 정의하였습니다. 샘플 수 확보를 위해 측정 기간은 7일로 설정하였습니다.

 결과 변수(플레이 변화)는 유저가 게임을 열심히 하는지를 반영할 수 있도록 1) 유저가 게임에 투입하는 시간 및 자본, 2) 유저가 즐기는 컨텐츠의 변화 두 가지 관점으로 살펴보았습니다. 유저가 게임에 투입하는 시간 및 자본이 증가하거나, 투입하는 시간의 변화가 적더라도 상위 컨텐츠를 이용하게 되는 경우 게임을 열심히 하게 되는 것 이라고 판단였기 때문입니다.

* 원인 변수
  *  최초 영웅/전설 획득 여부 (획득 : 실험군, 미획득 : 대조군)
* 결과 변수(플레이 변화)
  * 전후 30일 간 접속 일수 변화 : 이후 30일 간 접속 일수 - 이전 30일 간 접속 일수
  * 전후 30일 간 결제 금액 변화 : 이후 30일 간 결제 금액 - 이전 30일 간 결제 금액
  * 1/2/3/4주 후 유저 그룹 지표 상향 여부 : 1주 전 유저 그룹 지표 대비 n주 후 유저 그룹 지표의 변화 여ㅂ
    * 지표가 상향 시 1
    * 아닌 경우 0 

#### 1-2. 통제 변수 후보

 통제 변수 후보로는 영웅/전설 획득, 플레이 변화에 영향을 미칠 것으로 예상되는 변수를 탐색하였습니다. 

 MMORPG 특성 상 유저는 성장 → 정체 → 매몰 비용 의 과정을 경험하는데, 각 과정마다 영웅/전설 획득과 플레이 변화에 영향을 미칠 것으로 예상되는 총 9개의 변수를 선정하였습니다. 변수 집계 기간은 14일로 하였습니다(원인 변수 측정 기간 14일 전 ~ 원인 변수 측정 기간 1일 전)

* 성장 : 유저가 성장하는 재미를 느낄수록 향후 플레이가 증가할 것이다. (no.1 ~ 5)
* 정체 : 유저가 성장하지 못하고 정체해 있을수록 향후 플레이가 감소할 것이다. (no.6)
* 매몰 비용 : 게임에 오랜 시간을 투자했을수록 향후 플레이 감소가 적을 것이다. (no.7 ~ 9)

|  no  |       변수명        | 영향을 받을 것으로 예상되는 결과 변수 |
| :--: | :-----------------: | :-----------------------------------: |
|  1   |    희귀 등급 수     |          접속 일수, 결제금액          |
|  2   |  컬렉션 완성 횟수   |               접속 일수               |
|  3   |   스킬 습득 횟수    |               접속 일수               |
|  4   |  인챈트 성공 횟수   |               접속 일수               |
|  5   | 등급 합성 성공 횟수 |               결제 금액               |
|  6   |      사망 횟수      |         접속 일수, 결제 금액          |
|  7   | 계정 생성 후 경과일 |               접속 일수               |
|  8   |        레벨         |               접속 일수               |
|  9   |    총 결제액(원)    |          접속 일수, 결제금액          |

## 2. 분석 기간 선정

 분석 결과가 일부 기간에만 일시적으로 나타나는지 또는 여러 기간에 걸쳐 동일하게 나타나는지에 대한 재현성을 확인하기 위해 주요 업데이트 시점을 기준으로 총 5개의 분석 기간을 선정하였습니다.

 그 이유는 주요 업데이트 이후 게임 내 영웅/전설 등급의 가치가 변할 것이고 이에 따라 영웅/전설 획득이 플레이 변화에 미치는 인과 효과도 변할 것이라고 판단하였기 때문입니다. 크게 대규모 업데이트, 소규모 업데이트 두 종류로 나뉘었는데 이에 따라서도 인과 효과가 다르게 나타나는지 확인할 수 있을 것이라 판단하였습니다. 

* 대규모 업데이트 : 2개의 분석 기간
* 소규모 업데이트 : 3개의 분석 기간

## 3. 대상 선정

<p align="center"><img src = "/assets/works/class_get_causal_analysis/image3.png" width="90%" /><br>[그림4] 변수 집계 기간 선정을 위한 실험군, 대조군 d시점 매칭</p>

분석 대상은 측정 기간 전에 영웅/전설 획득을 한 적이 없고, 측정 기간 동안 게임에 접속하여 획득 시도를 한 유저로 선정하였습니다. 그 후, 영웅/전설 획득이 플레이 변화에 미치는 영향을 측정하기 위해 획득 여부에 따라 실험군(획득 유저), 대조군(미획득 유저)으로 나누었습니다. 마지막으로 변수 집계 기간을 설정하기 위해 측정 기간 7일 간 일자별로 유저를 매칭하였습니다

* 실험군(d시점) : 측정 기간 7일 간 영웅/전설 최초 획득을 d시점에 한 유저
* 대조군(d시점) : 측정 기간 7일 간 영웅/전설 최초 획득 시도를 d시점에 하였고 실패한 유저

 분석 대상에 원인 변수 측정 기간 동안 게임에 접속한 유저라는 조건으로 둔 이유는 역인과 관계로 인한(접속 → 영웅/전설 획득) 편향을 방지하기 위함입니다. 이러한 조건 없이 대상을 선택하면 대조군에 측정 기간 동안 게임에 접속하지 않아 영웅/전설 획득을 하지 못한 유저가 포함되어 실험군, 대조군 간에 공정한 비교가 어려울 것입니다.  

## 4. 세부 그룹

 영웅/전설 획득이 플레이 변화에 미치는 인과 효과가 특정 그룹에 따라 다르게 나타날 수가 있기 때문에 그룹별로 나누어 인과 효과를 측정하였습니다. 

가령, 유저가 PVP나 전투를 즐기는지 여부에 따라 영웅/전설 획득이 플레이에 변화에 미치는 영향이 다를 수 있습니다. PVP나 전투를 즐기는 유저는 영웅/전설 획득이 매우 중요하여 향후 플레이 증가에 큰 영향을 미칠 수 있고, 사냥 위주 플레이를 즐기는 유저에게는 큰 영향이 없을 수 있습니다. 그런데 이러한 유저의 PVP 및 전투 특성을 고려하지 않고 전체 집단에 대해 인과효과를 추정하게 되면, 두 그룹에서 각각 발생하는 인과 효과가 상쇄되어 인과효과가 존재하지 않는다는 결과가 나올 수 있습니다. 따라서, 인과 효과가 다르게 나타날 것으로 판단되는 특성에 따라 그룹을 나누어 분석하는 것이 좋습니다.  

 본 분석에서는 전반적인 플레이 성향을 나타내는 유저 그룹 지표에 따라 유저를 나누어 인과효과를 추정하는 것이 적절하다고 판단하였습니다.

* 그룹1 : 그룹2 대비 사용 시간, 게임 컨텐츠 참여도가 높은 유저
* 그룹2 : 사용 시간이 적고 게임 컨텐츠 참여도가 적은 유저

그리고, 결제 금액 변화에 대한 인과 효과 추정 시에는 기존에 결제를 하였는지에 따라 인과 효과가 다르게 나타날 것으로 판단하여 추가로 유저를 나누어 분석을 진행하였습니다.   

* 과금 유저 : 결제 이력이 있는 유저
* 무과금 유저 : 결제 이력이 없는 유저

|   인과 효과 추정    |                    세부 그룹                    |
| :-----------------: | :---------------------------------------------: |
|   접속 일수 변화    |         유저 그룹 지표 → 총 2개의 그룹          |
|   결제 금액 변화    | 유저 그룹 지표 & 기존 결제 여부 → 총 4개의 그룹 |
| 유저 그룹 상향 여부 |         유저 그룹 지표 → 총 2개의 그룹          |



## 5. 인과 다이어그램을 통한 통제 변수 구성

 이제 인과 효과 추정을 위해 통제 변수 후보에서 실제로 통제할 변수를 선택하는 과정입니다. 인과 효과 추정을 위해 전체적인 변수 간 관계를 확인할 차례입니다. 위에서 설명드렸듯이 변수 간 관계(confounder, collider)에 따라 변수의 통제 여부가 달라지기 때문에 변수 간 전체적인 관계를 파악하는 과정이 필요합니다. 그리고 변수 간 관계를 그린 것을 인과 다이어그램이라고 부릅니다.

##### 인과 다이어그램 요소

인과 다이어그램은 노드(Node), 엣지(Edge) 두 가지 요소로 구성됩니다. 노드는 변수를 의미하고 엣지는 노드 간 인과 관계를 의미합니다. 엣지는 화살표로 표현되며 엣지가 출발하는 노드가 원인, 도착하는 노드가 결과입니다.  

##### 인과 다이어그램 표현 방법

 예를 들어 "노드1이 원인이 되어 노드2가 증가 or 감소할 것이다"라는 인과 관계를 표현하고자 한다면 노드1 → 노드2로 화살표(엣지)로 연결해주면 됩니다. 그리고 인과 관계가 없다고 판단되는 경우 엣지로 연결하지 않으면 됩니다. 이것을 모든 노드 쌍에 대해 표시해주면 인과 다이어그램이 완성됩니다. 

여기서 주의할 점은 인과 다이어그램 내에서 cycle이 존재하면 안된다는 것입니다. 

* 예를 들어 노드1 → 노드2, 노드2 → 노드3, 노드3 → 노드1 인 관계가 존재하는 경우 노드1 → 노드2 → 노드3 → 노드1... 로 cycle이 생기게 됩니다.

본 분석에서는 A → B인 경우 B의 집계 시점을 A보다 더 나중으로 설정하여 cycle을 방지하였습니다.

##### 인과 다이어그램을 이용한 최종 통제 변수 선정 절차

우리가 알고 싶은 인과 효과를 추정하기 위해서는 이를 제외한 외부 영향을 모두 차단하여야 합니다. 아래의 인과 다이어그램을 보시면 인과 효과는 C1을 의미하는데 이를 제외한 원인 변수에서 결과 변수로 이어지는 모든 엣지의 영향을 차단하는 것입니다. 이를 위해 아래와 같이 4가지 단계를 거쳤습니다. 

* step1) 원인 변수, 결과 변수에 직접적인 영향을 주지 않는 인과 관계 무시를 위한 노드 통제
* step2) 원인 변수 외에 결과 변수에 영향을 주는 노드 통제
* step3) collider는 통제 변수에서 제외
* step4) 최종 통제 변수 선정
  * step1과 step2에서 선정된 통제 변수들 중 step3에 포함되는 변수는 제외 

### 5-1. 접속 일수 변화 인과 다이어그램

<p align="center"><img src = "/assets/works/class_get_causal_analysis/image4.png" width="70%" /><br>[그림5] 접속 일수 변화에 대한 인과 다이어그램</p>

**step1)**

* 영웅/전설 획득, 접속 일수 변화 노드에 연결되지 않는 엣지를 의미합니다(C3, C4, C5, C6, C12, C13)
* 해당 엣지가 향하는 노드를 통제함으로써 해당 인과 관계를 무시할 수 있습니다.(희귀 등급 수, 컬렉션 완성 횟수, 스킬 습득 횟수, 인챈트 성공 횟수, 레벨, 총 결제액 노드 통제)

**step2)**

* 접속 일수 변화 노드에 직접적으로 인과 영향을 미치는 영웅/전설 획득을 제외한 노드입니다(C7, C8, C9, C10, C11, C14)
* 해당 노드들은 측정하려는 인과효과(C1) 이외에 접속 일수 변화에 영향을 미치는 변수이므로 통제가 필요합니다(컬렉션 완성 횟수, 스킬 습득 횟수, 레벨, 총 결제액, 사망 횟수 노드 통제)

**step3)**

* 영웅/전설 획득, 접속 일수 변화 노드로부터 동시에 영향을 받는 노드를 의미합니다(없음)
* 해당 변수는 위에서 설명한 collider이므로, 통제 변수에서 제외하여야 합니다.

**step4)**

* step1, step2에서 선정된 통제 변수들 중 step3에 포함되는 변수를 제외합니다.
* (희귀 등급 수, 컬렉션 완성 횟수, 스킬 습득 횟수, 인챈트 성공 횟수, 레벨, 총 결제액, 사망 횟수)

이제 인과 효과 추정을 위해 선정된 통제 변수를 포함하여 모델을 구성합니다. 본 분석에서는 원인 변수, 통제 변수를 독립 변수로 하고 결과 변수를 종속 변수로 하는 선형 회귀 모델을 사용하였습니다.

* 접속 일수 변화 ~ 영웅/전설 획득 여부 + 희귀 등급 수 + 컬렉션 완성 횟수 + 스킬 습득 횟수 + 인챈트 성공 횟수 + 레벨 + 총 결제액 + 사망 횟수

### 5-2. 결제 금액 변화 인과 다이어그램

<p align="center"><img src = "/assets/works/class_get_causal_analysis/image5.png" width="60%" /><br>[그림6] 결제 금액 변화에 대한 인과 다이어그램</p>

위의 방식과 마찬가지로 최종 통제 변수를 선정하여 모델을 설계하면 아래와 같습니다.

* 결제 금액 변화 ~ 영웅/전설 획득 여부 + 희귀 등급 수 + 등급 합성 성공횟수 + 총 결제액 + 사망 횟수

### 5-3. 유저 그룹 지표 상향  인과 다이어그램

 유저 그룹 지표는 접속 일수, 결제 금액 등 전반적인 게임 플레이 활동량에 따라 산출되는 변수이기 때문에 통제 변수 후보의 합집합을 통제 변수로 사용하였습니다. 

 그리고 접속 일수 변화, 결제 금액 변화와 다르게 변수의 값이 binary type(0 또는 1)이므로 로지스틱 회귀 모델을 사용하였습니다.

* 유저 그룹 상향 여부 ~ 영웅/전설 획득 여부 + 희귀 등급 수 + 등급 합성 성공횟수 + 컬렉션 완성 횟수 + 스킬 습득 횟수 + 인챈트 성공 횟수 + 레벨 + 총 결제액 + 사망 횟수



# **분석 결과**

 5개의 기간에 대해 모두 분석을 진행한 결과 인과 효과는 조금씩 다르지만 전반적으로 "최초 영웅/전설 획득은 유저의 플레이 증가에 유의한 영향을 미친다"라는 결과가 나왔습니다. 그래서 아래에는 업데이트 종류별 하나의 분석 기간에 대한 결과만 첨부하였습니다. 

 아래의 그래프는 영웅/전설을 획득하지 못한 그룹(대조군) 대비 획득한 그룹(실험군)의 플레이 변화에 대한 차이의 평균 및 신뢰 구간을 나타냅니다. 해석 방법은 다음과 같습니다. 

* 신뢰 구간에 0인 값이 포함되지 않는다면 인과 효과는 유의한 것으로 해석합니다.
* 인과 효과가 유의한 경우, 신뢰 구간이 0인 값 우측에 있으면 "영웅/전설 획득은 플레이 변화의 증가에 영향을 준다" 라고 해석하고 반대의 경우 "영웅/전설 획득은 플레이 변화의 감소에 영향을 준다"라고 해석합니다.

### 5-1. 접속 일수 변화에 미치는 인과 효과 추정

|                     대규모 업데이트 이후                     |                     소규모 업데이트 이후                     |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
| <img src = "/assets/works/class_get_causal_analysis/image6_1.png" width="95%" /> | <img src = "/assets/works/class_get_causal_analysis/image6_2.png" width="95%" /> |

 모든 유저 그룹에서 최초 영웅/전설 획득은 30일 간 플레이 증가에 유의한 영향을 미치는 것으로 나타납니다. 유저의 플레이 성향에 관계 없이 영웅/전설 획득은 30일 간 지켜보았을 때 접속 유도에 영향을 준다라고 해석할 수 있습니다. 

여기서 그룹 간 영향의 크기 차이가 존재하는데 대규모 업데이트 이후 그룹1에서는 인과 효과가 약 1.7일인 반면 게임 참여도가 낮은 그룹2에서는 5.1일로 더 큰 효과가 나타나는 것을 알 수 있습니다. 이를 보았을 때 기존에 접속을 자주 하지 않던 유저에게 최초 영웅/전설 획득은 더 자주 접속하게 하는 요인이 된다는 것을 알 수 있습니다. 

그리고, 소규모 업데이트 이후보다 대규모 업데이트 이후에서 영향이 크게 나타난 것을 알 수 있습니다.

**→ 영웅/전설 획득은 유저의 접속을 독려하는 효과가 있으며, 특히 게임 참여도가 낮은 그룹에 효과가 크다**

### 5-2. 결제 금액 변화에 미치는 인과 효과 추정

| 구분   |                     대규모 업데이트 이후                     |                     소규모 업데이트 이후                     |
| ------ | :----------------------------------------------------------: | :----------------------------------------------------------: |
| 무과금 | <img src = "/assets/works/class_get_causal_analysis/image7_1.png"/> | <img src = "/assets/works/class_get_causal_analysis/image7_2.png"/> |
| 과금   | <img src = "/assets/works/class_get_causal_analysis/image7_3.png"/> | <img src = "/assets/works/class_get_causal_analysis/image7_4.png"/> |

결제 금액 변화에 대해서는 과대 추정을 방지하기 위해 결제 금액 변화가 증가한 유저(이후 30일 간 결제 금액 > 이전 30일 간 결제금액) 대상으로 이상치인 유저를 제외한 후 분석을 진행하였습니다. 

모든 유저 그룹에서 최초 영웅/전설 획득은 30일 간 결제 금액 증가에 유의한 영향을 미치는 것으로 나타납니다. 여기서 주목할 점은 무과금, 과금 그룹에 미치는 인과 효과의 크기 차이입니다. 무과금 그룹에서는 인과효과가 10,000원 미만인 반면, 30,000원 ~ 170,000원 이하로 효과가 더 큰 것을 알 수 있습니다.

**→ 영웅/전설 획득은 유저의 결제 증가에 영향을 미치며, 과금 그룹에서 효과가 더 크게 나타난다**

### 5-3. 유저 그룹 상향 여부에 미치는 인과 효과 추정

|                     대규모 업데이트 이후                     |                     소규모 업데이트 이후                     |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
| <img src = "/assets/works/class_get_causal_analysis/image8_1.png" width="95%"/> | <img src = "/assets/works/class_get_causal_analysis/image8_2.png" width="95%"/> |

 사용한 로지스틱 회귀 모델에서 회귀 계수는 로그 오즈비(영웅/전설 획득을 하지 않았을 때 대비 획득하였을 때 유저 그룹이 상향될 확률이 몇 배나 더 큰지)를 나타냅니다. 본 분석에서는 결과 해석에 편의를 위해 유저 그룹이 상향될 확률에 대한 영웅/전설 획득 여부가 미치는 영향의 미분값을 이용해 marginal effect 를 구하였습니다. 즉, x축이 의미하는 것은 유저 그룹 상향에 확률에 대한 최초 영웅/전설 획득의 인과 효과를 의미합니다.

모든 유저 그룹에서 최초 영웅/전설 획득은 유저 그룹 상향 확률 증가에 유의한 영향을 미치는 것으로 나타납니다. 여기서 유저 그룹 간 영향 크기 차이가 존재하는데 대규모 업데이트 이후 그룹1에서는 인과효과가 1.3%p인 반면 게임 참여도가 낮은 그룹2에서는 10.5%p로 더 큰 효과가 나타나는 것을 알 수 있습니다. 

유저 그룹 상향은 전반적인 게임 참여도 증가를 의미하므로, 아래와 같이 해석할 수 있습니다.

**→ 영웅/전설 획득은 유저의 전반적인 게임 플레이 증가에 영향을 미치며, 특히 게임 참여도가 저조한 그룹에 효과가 크게 나타난다**

# **마치며**

 지금까지 게임 내 컨텐츠가 유저의 플레이 변화에 원인이 되는지 인과 분석에 대해 소개드렸습니다. 최초 영웅/전설 획득 자체가 유저의 단기간(30일) 플레이 증대에 긍정적인 영향을 주었고, 기존의 유저 성향 및 게임 애착도에 따라 영향이 다르게 나타난 것을 알 수 있었습니다. 

 본 포스팅에서는 주로 분석 기법 및 결과에 대한 내용을 다루었지만 실제로 분석을 진행하며 가장 중요하다고 느낀 것은 도메인 지식입니다. 본 분석에서 핵심이라고 할 수 있는 인과 다이어그램 자체가 도메인에 대한 이해를 바탕으로 설계되어야 하기 때문이죠. 예를 들어 도메인 지식이 없이 실제로 collider인 변수를 confounder로 착각하여 분석한다면 실제 인과 효과가 아닌 편향된 결과를 얻었을 것입니다. 

즉, 분석 기법이 아무리 훌륭하여도 도메인 지식이 없다면 설계 단계부터 잘못되어 있을 가능성이 높고 결국 잘못된 분석 결과가 나올 수 있습니다. 그만큼 설계 부분에 많은 고민과 시간을 투자해야하는 것이 중요하다는 것을 느낄 수 있었습니다.

본 분석을 진행하며 영웅/전설을 획득하였더라도 유저가 만족하지 않는 경우 플레이 변화가 다르게 나타나지 않을까? 라는 궁금증이 생겼습니다. 그래서 2탄으로는 "최초 획득한 영웅/전설에 대한 만족도는 플레이 변화에 영향을 미칠까?"라는 주제로 분석한 내용을 공유드리려 합니다 :) 



# **Appendix.**

#### 인과효과 추정 시 고려사항

*아래 그림들의 출처는 [(YOUTUBE) Brady Neal - Causal Inference](https://www.youtube.com/c/BradyNealCausalInference/featured)입니다.*

- T : 원인변수
- Y : 결과변수
- X : 외생 변수

<img src = "/assets/works/class_get_causal_analysis/image9_1.png" width="25%"/>

- T → Y : Causal Association (분석가가 알고 싶어하는 T와 Y 사이의 인과효과)
- T ← X → Y : Non-Causal Association (인과효과 이외에 T와 Y를 연결하는 path)
  - path : edge의 방향에 상관 없이 두 노드 간 연결될 수 있는 경로



T가 Y에 미치는 인과효과 추정을 위해서는 non-causal association을 block해야 합니다

<img src = "/assets/works/class_get_causal_analysis/image9_2.png" width="25%"/>

- block : 통제를 통해 non-causal association 상에서 T와 Y의 관계를 독립으로 만들어 주는 것
- 노드 간의 관계(화살표 방향)에 따라 통제하는 방법이 다름



#### 인과 그래프에서 association의 종류

x1과 x3의 association이 형성되는 세 가지 경우

1. Chain

   <img src = "/assets/works/class_get_causal_analysis/image9_3.png" width="25%"/>

2. Fork

   <img src = "/assets/works/class_get_causal_analysis/image9_4.png" width="25%"/>

   - $$x_2$$는 $$x_1$$과 $$x_3$$에 **영향을 줌** : x2는 x1과 x3의 Confounder

3. Imorality

   <img src = "/assets/works/class_get_causal_analysis/image9_5.png" width="25%"/>

   - $$x_2$$는 $$x_1$$과 $$x_3$$의 **영향을 받음** : x2는 x1과 x3의 Collider



#### non-causal association의 영향을 제거(block)

위의 Chain, Fork, Immorality의 각 관계에서 non-causal association의 영향을 제거하기 위해 통제할 변수를 선정

(위의 예시에서 $$x_1$$(원인변수), $$x_3$$(결과변수)로 간주함)



##### 확인 절차

1) bayesian network factorization을 통해 확률을 계산 

- chain rule of probability에 local markov assumption을 적용한 개념

  -  chain rule of probability
     -  $$ p(x_1, x_2, ..., x_n) = \[ \prod_i {p(x_i | x_{i-1}, x_{i-2}, ..., x_1)} \] $$
  -  local markov assumption
     -  DAG에서 노드 X($$x_i$$)는 부모노드($$pa_i$$)에게만 영향을 받음
     -  자식 노드에게는 영향을 받지 않음

  - <u>bayesian network factorization</u>
    - $$ p(x_1, x_2, ..., x_n) = \[ \prod_i {p(x_i | pa_i)} \] $$

2) 변수 통제(조건부 확률) 시 원인 변수와 결과 변수의 독립성 확인 



##### **독립성 만족을 위한 통제 변수 확인 결과**

1. **Chain에 의한 non-causal association**

   * bayesian network factorization 
     * $$p(x_1,x_2,x_3) = p(x_1) * p(x_2 | x_1) *  p(x_3|x_2)$$

   - x2 통제 시 x1과 x3의 독립성 확인
     - $$p(x_1, x_3 | x_2) = {p(x_1, x_2, x_3) \over p(x_2)}$$(베이즈 정리)
     - $${p(x_1) * p(x_2|x_1) * p(x_3 | x_2) \over p(x_2)} = {p(x2, x_1) * p(x_3|x_2) \over p(x_2)} = {p(x_2, x_1) \over p(x_2)} * p(x_3|x_2) = p(x_1 | x_2) * p(x_3 | x_2)$$(분자에 bayesian network factorization에 의해 도출 된 식 대입, 베이즈 정리 적용)
     - $$\newcommand{\indep}{\perp \!\!\! \perp}
       x_1 \indep x_3 | x_2$$(x2를 통제하는 경우, x1과 x3가 독립이 됨) 
     - **즉, chain의 경우 중간에 위치한 노드(변수)를 통제하면 해당 non-causal association(x1 → x3)가 block 됨**

2. **Fork에 의한 non-causal association**

   - bayesian network factorization 
     - $$p(x_1,x_2,x_3) = p(x_2) * p(x_1 | x_2) *  p(x_3|x_2)$$
   - x2 통제 시 x1과 x3의 독립성 확인
     - $$p(x_1, x_3 | x_2) = {p(x_1, x_2, x_3) \over p(x_2)}$$ (베이즈 정리)
     - $${p(x_2) * p(x_1 | x_2) *  p(x_3|x_2) \over p(x_2)} = {p(x1, x_2) * p(x_3|x_2) \over p(x_2)} = {p(x_1, x_2) \over p(x_2)} * p(x_3|x_2) = p(x_1 | x_2) * p(x_3 | x_2)$$
       (분자에 bayesian network factorization에 의해 도출 된 식 대입, 베이즈 정리 적용)
     - $$\newcommand{\indep}{\perp \!\!\! \perp}
       x_1 \indep x_3 | x_2$$ (x2를 통제하는 경우, x1과 x3가 독립이 됨)
     - **즉, fork의 경우 confounder를 통제하면 해당 non-causal association(x1 → x3)가 block 됨**

3. **Immorality에 의한 non-causal association**

   - bayesian network factorization
     - $$p(x_1,x_2,x_3) = p(x_1) * p(x_3) *  p(x_2|x_1, x_3)$$
   - x2 통제 시 x1과 x3의 독립성 확인
     - $$p(x_1, x_3 | x_2) = {p(x_1, x_2, x_3) \over p(x_2)}$$ (베이즈 정리)
     - $${ p(x_1) * p(x_3) *  p(x_2|x_1, x_3) \over p(x_2)}$$ (분자에 위의 식 대입)
     - $$ \newcommand{\indep}{\perp \!\!\! \perp}
       x_1 \ \not\indep x_3 | x_2 $$ (**x2를 통제하는 경우, x1과 x2는 독립이 아님**)
   - x2를 통제하지 않고 x1, x3의 독립성 확인
     - $$p(x_1,x_3) = \sum_{x_2} {p(x_1, x_3, x_2)}$$ (marginalize)
     - $$ p(x_1,x_3) = \sum_{x_2} {p(x_1, x_3, x_2)} = \sum_{x_2} {p(x_1) * p(x_3) * p(x_2|x_1, x_3)} =p(x_1) * p(x_3) * \sum_{x_2} { p(x_2|x_1, x_3) } = p(x_1) * p(x_3) * 1 = p(x_1) * p(x_3)$$
       (bayesian network factorization에 의해 도출 된 식 대입)
     - $$ \newcommand{\indep}{\perp \!\!\! \perp}
       x_1 \indep x_3 $$ (x2를 통제하지 않는 경우, x1과 x3가 독립이 됨)
     - 즉, fork의 경우 colllider를 통제하지 않는 경우 이를 제외한 두 노드는 독립임
       - **collider를 통제하면 해당 non-causal association이 발생(collider bias)**
       - **따라서, immorality에 의한 원인 변수와 결과 변수의 association을 제거하기 위해서는 collider를 통제하지 않고 그대로 두어야 함**